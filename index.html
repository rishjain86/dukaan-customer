<!doctype html>
<html lang="hi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Dukaan Customer</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
body{background:#f5f5f5;}
.item-card{background:#fff;border-radius:10px;padding:10px;margin-bottom:12px;box-shadow:0 2px 5px rgba(0,0,0,0.1);}
.item-img{width:100%;height:120px;object-fit:cover;border-radius:8px;background:#eee;}
.add-btn{margin-top:8px;width:100%;}
.cart-btn{position:fixed;right:20px;bottom:20px;z-index:999;border-radius:18px;padding:10px 20px;}
</style>
</head>
<body>

<nav class="navbar navbar-dark bg-primary px-3">
  <span class="navbar-brand">ðŸ“¦ Dukaan</span>
  <span class="text-white" id="shop-id-label">SHOP001</span>
</nav>

<div class="container mt-3">
  <div class="row g-2">
    <div class="col-6">
      <select id="category-filter" class="form-select">
        <option value="all">All Categories</option>
      </select>
    </div>
    <div class="col-6">
      <input id="search-box" class="form-control" placeholder="Search items...">
    </div>
  </div>

  <div id="loading" class="text-center mt-4">à¤²à¥‹à¤¡ à¤•à¤° à¤°à¤¹à¤¾ à¤¹à¥ˆâ€¦</div>
  <div id="items-list" class="row mt-3"></div>
</div>

<button class="btn btn-primary cart-btn" onclick="openCart()">
ðŸ›’ Cart â€¢ <span id="cart-count">0</span>
</button>

<div class="modal fade" id="cartModal">
  <div class="modal-dialog modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header">
        <h5>Your Cart</h5>
        <button class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body" id="cart-items"></div>
      <div class="p-3 text-end">
        <strong>Total: â‚¹<span id="cart-total">0</span></strong>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        <button class="btn btn-success">Proceed to Checkout</button>
      </div>
    </div>
  </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
// CONFIG
const firebaseConfig = {
  apiKey: "AIzaSyAomDsqeL0rXvnudqUsudnZW0phuqMQbvY",
  authDomain: "shopkeeper-99756.firebaseapp.com",
  projectId: "shopkeeper-99756",
  storageBucket: "shopkeeper-99756.appspot.com"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

let shopId = "SHOP001";
let allItems = [];
let cart = JSON.parse(localStorage.getItem("cart") || "[]");

// Helpers
function getImg(u){ return u ? u : "https://via.placeholder.com/300x200?text=No+Image"; }
function saveCart(){ localStorage.setItem("cart", JSON.stringify(cart)); }
function updateCartBadge(){ document.getElementById("cart-count").innerText = cart.length; }

// Load items
db.collection("shops").doc(shopId).collection("items").orderBy("name")
.onSnapshot(s => {
  document.getElementById("loading").style.display = "none";
  allItems = s.docs.map(d=>({id:d.id,...d.data()}));
  renderItems(allItems);
});

// Render Items
function renderItems(list){
  let html="";
  if(list.length===0){
    html = "<div class='text-center mt-4'>à¤•à¥‹à¤ˆ à¤†à¤‡à¤Ÿà¤® à¤¨à¤¹à¥€à¤‚ à¤®à¤¿à¤²à¤¾à¥¤</div>";
  } else {
    html = list.map(i=>`
      <div class="col-6">
        <div class="item-card">
          <img class="item-img" src="${getImg(i.imageUrl)}">
          <strong>${i.name}</strong><br>
          â‚¹${i.offerPrice ?? i.price}  
          <button class="btn btn-primary add-btn" onclick="addToCart('${i.id}')">Add to Cart</button>
        </div>
      </div>
    `).join("");
  }
  document.getElementById("items-list").innerHTML = html;
}

// Add to Cart
function addToCart(id){
  if(!cart.find(x=>x.id===id)){
    let item = allItems.find(x=>x.id===id);
    cart.push({...item, qty:1});
    saveCart();
    updateCartBadge();
  }
  openCart();
}

// Cart Modal
function openCart(){
  let html = cart.map(i=>`
    <div class="d-flex justify-content-between border-bottom py-2">
      <div>
        <strong>${i.name}</strong><br>
        â‚¹${i.offerPrice ?? i.price} Ã— ${i.qty}
      </div>
      <div>
        <button class="btn btn-sm btn-outline-secondary" onclick="changeQty('${i.id}',-1)">-</button>
        <span class="mx-2">${i.qty}</span>
        <button class="btn btn-sm btn-outline-secondary" onclick="changeQty('${i.id}',1)">+</button>
      </div>
    </div>
  `).join("");
  document.getElementById("cart-items").innerHTML = html;
  updateTotal();
  new bootstrap.Modal(document.getElementById('cartModal')).show();
}

function changeQty(id, d){
  let it = cart.find(x=>x.id===id);
  if(!it) return;
  it.qty += d;
  if(it.qty<=0) cart = cart.filter(x=>x.id!==id);
  saveCart();
  updateCartBadge();
  openCart();
}

function updateTotal(){
  let t = cart.reduce((s,i)=> s + (i.offerPrice ?? i.price) * i.qty, 0);
  document.getElementById("cart-total").innerText = t;
}

// Filters
document.getElementById("search-box").oninput = e=>{
  let v = e.target.value.toLowerCase();
  renderItems(allItems.filter(x=>x.name.toLowerCase().includes(v)));
};
</script>

</body>
</html>
